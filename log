import java.io.BufferedWriter;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.StandardOpenOption;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

/**
 * Simple logger that appends lines to a log file with timestamp.
 */
public class Log {
    private final Path path;
    private final DateTimeFormatter fmt = DateTimeFormatter.ofPattern("HH:mm:ss MM/dd/yyyy");

    public Log(Path path) {
        this.path = path;
        try {
            if (!Files.exists(path)) {
                Files.createFile(path);
            }
        } catch (IOException e) {
            System.err.println("Unable to create log file: " + e.getMessage());
        }
    }

    public synchronized void log(String username, String message) {
        String ts = LocalDateTime.now().format(fmt);
        String line = String.format("%s - %s - %s", ts, username, message);
        try (BufferedWriter bw = Files.newBufferedWriter(path, StandardOpenOption.APPEND)) {
            bw.write(line);
            bw.newLine();
        } catch (IOException e) {
            System.err.println("Log write failed: " + e.getMessage());
        }
    }
}
